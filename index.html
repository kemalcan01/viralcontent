<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rec709pro: Viral İçerik Fabrikası</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap');
        body { font-family: 'Space Grotesk', sans-serif; background-color: #0a0a0a; color: #f5f5f5; }
        .gold-text { color: #d4af37; }
        .gold-bg { background: linear-gradient(135deg, #d4af37 0%, #f9e29c 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .loading-shimmer { background: linear-gradient(90deg, #111, #222, #111); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="p-6 border-b border-white/5 sticky top-0 bg-black/80 backdrop-blur-md z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tighter">rec709pro <span class="gold-text">VIRAL FACTORY</span></h1>
            <div class="text-[10px] text-slate-500 uppercase tracking-widest text-right">DUBAI / AI ENGINE</div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 space-y-12">
        <section class="glass-card p-8 rounded-3xl space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <input type="text" id="sector-input" placeholder="Sektör (Örn: Dubai Emlak)" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white outline-none">
                <input type="text" id="topic-input" placeholder="Konu (Örn: Vergisiz Yatırım)" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white outline-none">
            </div>
            <button onclick="generateViralIdeas()" id="main-btn" class="w-full gold-bg text-black font-extrabold p-4 rounded-xl active:scale-95 transition-all">ANALİZİ BAŞLAT</button>
        </section>

        <div id="loader" class="hidden"><div class="loading-shimmer h-40 rounded-3xl"></div></div>

        <div id="results-container" class="hidden space-y-12">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 glass-card p-6 rounded-3xl h-64"><canvas id="scoreChart"></canvas></div>
                <div class="lg:col-span-1 bg-amber-500/10 p-6 rounded-2xl border border-amber-500/20">
                    <p id="ai-strategic-note" class="text-sm text-slate-300 italic"></p>
                </div>
            </div>
            <div id="ideas-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </div>
    </main>

    <script>
        const apiKey = "AIzaSyD1uthSuA1ivrZg5idcDBdP7qX3AI63KO0";

        async function generateViralIdeas() {
            const sector = document.getElementById('sector-input').value;
            const topic = document.getElementById('topic-input').value;
            const btn = document.getElementById('main-btn');
            
            if(!sector || !topic) return alert("Alanları doldurun.");

            btn.disabled = true;
            btn.innerText = "Yapay Zeka Çalışıyor...";
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('results-container').classList.add('hidden');

            // API URL güncellendi: v1beta yerine v1 ve model ismi güncellendi
            const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

            const systemPrompt = "Sen Dubai merkezli bir viral içerik stratejistisin. Cevabını SADECE JSON formatında ver. JSON şeması: { \"strategic_note\": \"...\", \"ideas\": [ { \"title\": \"...\", \"viral_score\": 90, \"hook\": \"...\", \"type\": \"Reels\" } ] }";

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Sektör: ${sector}, Konu: ${topic}. Sistem Talimatı: ${systemPrompt}` }] }]
                    })
                });

                if (!response.ok) {
                    const errorJson = await response.json();
                    throw new Error(errorJson.error.message);
                }

                const data = await response.json();
                const contentText = data.candidates[0].content.parts[0].text;
                const cleanJson = contentText.replace(/```json/g, "").replace(/```/g, "").trim();
                const parsedData = JSON.parse(cleanJson);

                renderResults(parsedData);
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('results-container').classList.remove('hidden');
            } catch (err) {
                alert("Hata: " + err.message);
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerText = "ANALİZİ BAŞLAT";
            }
        }

        function renderResults(data) {
            document.getElementById('ai-strategic-note').innerText = data.strategic_note;
            const grid = document.getElementById('ideas-grid');
            grid.innerHTML = '';
            const labels = [];
            const scores = [];

            data.ideas.forEach(idea => {
                labels.push(idea.title.substring(0, 10));
                scores.push(idea.viral_score);
                const card = document.createElement('div');
                card.className = 'glass-card p-6 rounded-3xl border-l-4 border-amber-500';
                card.innerHTML = `
                    <div class="flex justify-between mb-2"><span class="text-[10px] text-slate-500 uppercase">${idea.type}</span><span class="gold-text font-bold">${idea.viral_score}</span></div>
                    <h4 class="font-bold text-sm mb-2">${idea.title}</h4>
                    <p class="text-xs italic text-slate-400">"${idea.hook}"</p>
                `;
                grid.appendChild(card);
            });
            updateChart(labels, scores);
        }

        let myChart;
        function updateChart(labels, scores) {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: labels, datasets: [{ data: scores, backgroundColor: '#d4af37' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }
    </script>
</body>
</html>
